<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MyOrder — Personal Menu Hub</title>
  <style>
    /* Restaurant-friendly theme: warm neutrals + fresh greens, lighter UI */
    :root{
      --bg1:#fff7ed;     /* warm paper */
      --bg2:#ecfdf5;     /* mint tint */
      --card:#ffffff;
      --card2:#f8fafc;
      --text:#0f172a;
      --muted:#475569;
      --line:#e2e8f0;
      --shadow: 0 10px 30px rgba(15, 23, 42, .10);

      --green:#16a34a;   /* fresh */
      --green2:#22c55e;
      --amber:#f59e0b;   /* warm accent */
      --blue:#2563eb;    /* action */
      --danger:#e11d48;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      /* subtle warm restaurant background */
      background:
        radial-gradient(900px 520px at 15% 0%, rgba(34,197,94,.18) 0%, rgba(34,197,94,0) 55%),
        radial-gradient(900px 520px at 90% 10%, rgba(245,158,11,.18) 0%, rgba(245,158,11,0) 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      font-family: ui-rounded, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    .wrap{max-width:1100px;margin:0 auto;padding:18px}

    header{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      padding:16px;
      border:1px solid var(--line);
      border-radius:18px;
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
    }
    .brand h1{
      margin:0;
      font-size:20px;
      letter-spacing:.2px;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
    }
    .brand h1 .mark{color:var(--green)}
    .brand p{margin:6px 0 0;color:var(--muted);font-size:13px;line-height:1.35}

    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
      background: rgba(248,250,252,.9);
    }
    .pill b{color:var(--text);font-weight:700}

    main{display:grid;grid-template-columns: 1.1fr .9fr;gap:14px;margin-top:14px}
    @media (max-width: 980px){ main{grid-template-columns:1fr} }

    .card{
      border:1px solid var(--line);
      background: rgba(255,255,255,.9);
      border-radius:18px;
      padding:16px;
      box-shadow: var(--shadow);
    }
    .card h2{margin:0 0 10px;font-size:14px;color:var(--text);letter-spacing:.2px}
    .subtle{color:var(--muted);font-size:12px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width: 560px){ .grid2{grid-template-columns:1fr} }

    label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
    select, input[type="text"], textarea{
      width:100%;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--line);
      background: #fff;
      color:var(--text);
      outline:none;
      box-shadow: 0 1px 0 rgba(15,23,42,.03);
    }
    select:focus, input[type="text"]:focus, textarea:focus{
      border-color: rgba(34,197,94,.55);
      box-shadow: 0 0 0 4px rgba(34,197,94,.14);
    }
    textarea{min-height:84px;resize:vertical}

    .group{margin:12px 0 0}
    .choices{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}

    .chip{
      user-select:none;
      display:inline-flex; align-items:center; gap:8px;
      padding:9px 12px;
      border:1px solid var(--line);
      border-radius:999px;
      background: linear-gradient(180deg, #ffffff, #f8fafc);
      cursor:pointer;
      transition: transform .05s ease, border-color .15s ease, box-shadow .15s ease;
      font-size:13px;
      color: var(--text);
    }
    .chip:hover{transform: translateY(-1px); border-color:#cbd5e1; box-shadow: 0 6px 16px rgba(15,23,42,.08)}
    .chip input{display:none}
    .chip[data-on="1"]{
      border-color: rgba(34,197,94,.65);
      background: linear-gradient(180deg, rgba(34,197,94,.14), rgba(34,197,94,.06));
      box-shadow: 0 0 0 3px rgba(34,197,94,.10);
    }

    .actions{
      display:flex;flex-wrap:wrap;gap:10px;justify-content:flex-end;margin-top:12px
    }
    button{
      border:1px solid var(--line);
      background: linear-gradient(180deg, #fff, #f8fafc);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
      letter-spacing:.15px;
    }
    button.primary{
      border-color: rgba(37,99,235,.35);
      background: linear-gradient(180deg, rgba(37,99,235,.12), rgba(37,99,235,.06));
    }
    button.good{
      border-color: rgba(34,197,94,.45);
      background: linear-gradient(180deg, rgba(34,197,94,.16), rgba(34,197,94,.06));
    }
    button.danger{
      border-color: rgba(225,29,72,.35);
      background: linear-gradient(180deg, rgba(225,29,72,.12), rgba(225,29,72,.06));
    }
    button:active{transform: translateY(1px)}

    .preview{position:sticky; top:14px}
    @media (max-width: 980px){ .preview{position:relative; top:auto} }

    .receipt{
      border:1px dashed #cbd5e1;
      border-radius:18px;
      padding:14px;
      background: #ffffff;
    }
    .receipt .title{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .receipt h3{margin:0;font-size:15px;font-family: ui-serif, Georgia, "Times New Roman", Times, serif}
    .receipt .meta{color:var(--muted);font-size:12px;margin-top:4px}
    .line{height:1px;background:#e2e8f0;margin:12px 0}
    .kv{display:flex;justify-content:space-between;gap:10px;font-size:13px}
    .kv span{color:var(--muted)}
    .items{margin-top:10px}
    .muted{color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}

    .barcodeBox{
      margin-top:12px;
      padding:12px;
      border:1px solid var(--line);
      border-radius:18px;
      background: linear-gradient(180deg, #ffffff, #f8fafc);
      text-align:center;
    }
    #barcode{max-width:100%; height:auto}

    /* Modal */
    .modalBackdrop{
      position:fixed; inset:0;
      background: rgba(15,23,42,.45);
      display:none; align-items:center; justify-content:center;
      padding:16px;
    }
    .modalBackdrop[data-open="1"]{display:flex}
    .modal{
      width:min(760px, 100%);
      border-radius:20px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.96);
      box-shadow: 0 30px 80px rgba(15, 23, 42, .25);
      overflow:hidden;
    }
    .modal header{
      border:none;border-radius:0;
      background:
        radial-gradient(900px 320px at 15% 0%, rgba(34,197,94,.22) 0%, rgba(34,197,94,0) 60%),
        radial-gradient(900px 320px at 90% 0%, rgba(245,158,11,.20) 0%, rgba(245,158,11,0) 60%),
        rgba(248,250,252,.9);
      box-shadow: inset 0 -1px 0 rgba(226,232,240,.9);
    }
    .modal .content{padding:14px}
    .modal .content p{margin:0 0 10px;color:var(--muted);font-size:13px}
    .printNote{font-size:12px;color:var(--muted);margin-top:10px}

    @media print{
      body{background:#fff;color:#000}
      header,.card:not(.printable), .actions, .pill {display:none !important}
      main{display:block}
      .preview{position:static}
      .card{border:none;box-shadow:none;background:#fff;padding:0}
      .receipt{border:1px dashed #666;background:#fff}
      .barcodeBox{border:1px solid #aaa;background:#fff}
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.6/dist/JsBarcode.all.min.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <h1>Personal Menu Hub — <span class="mark">MyOrder</span></h1>
        <p>
          Build your Subway order with modifiers, then show a clean final screen to the cashier.
          <br/>Fewer mistakes • Faster checkout • Works on your phone
        </p>
      </div>
      <div class="pill">
        <span>Status:</span> <b id="statusText">Building</b>
      </div>
    </header>

    <main>
      <section class="card">
        <h2>Build your order</h2>
        <div class="subtle">Choose your sandwich, then tap veggies/sauces. Add a name if ordering for someone else.</div>

        <div class="group grid2">
          <div>
            <label for="customerName">Name (optional)</label>
            <input id="customerName" type="text" placeholder="e.g., Alex" maxlength="32" />
          </div>
          <div>
            <label for="storeNote">Store note (optional)</label>
            <input id="storeNote" type="text" placeholder="e.g., To-go / cut in half" maxlength="64" />
          </div>
        </div>

        <div class="group grid2">
          <div>
            <label for="sandwich">Sandwich</label>
            <select id="sandwich">
              <option value="Turkey">Turkey</option>
              <option value="Ham">Ham</option>
              <option value="Italian B.M.T.">Italian B.M.T.</option>
              <option value="Tuna">Tuna</option>
              <option value="Meatball Marinara">Meatball Marinara</option>
              <option value="Steak & Cheese">Steak & Cheese</option>
              <option value="Chicken Teriyaki">Chicken Teriyaki</option>
              <option value="Veggie Delite">Veggie Delite</option>
              <option value="Spicy Italian">Spicy Italian</option>
              <option value="Roast Beef">Roast Beef</option>
            </select>
          </div>
          <div>
            <label for="size">Size</label>
            <select id="size">
              <option value="6-inch">6-inch</option>
              <option value="Footlong">Footlong</option>
              <option value="Wrap">Wrap</option>
            </select>
          </div>
        </div>

        <div class="group grid2">
          <div>
            <label for="bread">Bread</label>
            <select id="bread">
              <option value="Italian">Italian</option>
              <option value="Wheat">Wheat</option>
              <option value="Italian Herbs & Cheese">Italian Herbs & Cheese</option>
              <option value="Honey Oat">Honey Oat</option>
              <option value="Flatbread">Flatbread</option>
              <option value="No bread (salad)">No bread (salad)</option>
            </select>
          </div>
          <div>
            <label for="toast">Toasted?</label>
            <select id="toast">
              <option value="Not toasted">Not toasted</option>
              <option value="Toasted">Toasted</option>
            </select>
          </div>
        </div>

        <div class="group grid2">
          <div>
            <label for="cheese">Cheese</label>
            <select id="cheese">
              <option value="No cheese">No cheese</option>
              <option value="American">American</option>
              <option value="Provolone">Provolone</option>
              <option value="Pepper Jack">Pepper Jack</option>
              <option value="Shredded Monterey Cheddar">Shredded Monterey Cheddar</option>
            </select>
          </div>
          <div>
            <label for="extraCheese">Extra cheese</label>
            <select id="extraCheese">
              <option value="No">No</option>
              <option value="Yes">Yes</option>
            </select>
          </div>
        </div>

        <div class="group">
          <label>Veggies</label>
          <div class="choices" id="vegChoices"></div>
          <div class="subtle" style="margin-top:6px">Tap to toggle. Leave blank for “no veggies”.</div>
        </div>

        <div class="group">
          <label>Sauces</label>
          <div class="choices" id="sauceChoices"></div>
        </div>

        <div class="group grid2">
          <div>
            <label for="seasoning">Seasoning</label>
            <select id="seasoning">
              <option value="None">None</option>
              <option value="Salt & pepper">Salt & pepper</option>
              <option value="Parmesan cheese">Parmesan cheese</option>
              <option value="Oregano">Oregano</option>
              <option value="Everything seasoning">Everything seasoning</option>
            </select>
          </div>
          <div>
            <label for="extras">Extras</label>
            <select id="extras">
              <option value="None">None</option>
              <option value="Add bacon">Add bacon</option>
              <option value="Add avocado">Add avocado</option>
              <option value="Double meat">Double meat</option>
            </select>
          </div>
        </div>

        <div class="group grid2">
          <div>
            <label for="side">Side</label>
            <select id="side">
              <option value="None">None</option>
              <option value="Chips">Chips</option>
              <option value="Cookie">Cookie</option>
              <option value="Apple slices">Apple slices</option>
            </select>
          </div>
          <div>
            <label for="drink">Drink</label>
            <select id="drink">
              <option value="None">None</option>
              <option value="Bottled water">Bottled water</option>
              <option value="Fountain drink">Fountain drink</option>
              <option value="Iced tea">Iced tea</option>
            </select>
          </div>
        </div>

        <div class="group">
          <label for="specialInstructions">Special instructions (optional)</label>
          <textarea id="specialInstructions" placeholder="e.g., Light mayo, extra pickles, cut in 3 pieces"></textarea>
        </div>

        <div class="actions">
          <button class="danger" id="resetBtn" type="button">Reset</button>
          <button class="primary" id="saveBtn" type="button">Save to this device</button>
          <button class="good" id="orderBtn" type="button">Order</button>
        </div>
      </section>

      <aside class="card preview printable">
        <h2>Final order preview</h2>
        <div class="subtle">This is what you’ll show the cashier. Tap <b>Order</b> for a full-screen receipt + barcode.</div>

        <div class="receipt" id="receiptPreview">
          <div class="title">
            <div>
              <h3>MyOrder — Final Order</h3>
              <div class="meta" id="previewMeta"></div>
            </div>
            <div class="mono muted" id="previewOrderId"></div>
          </div>
          <div class="line"></div>
          <div class="items" id="previewItems"></div>
          <div class="line"></div>
          <div class="kv"><span>Note</span><div id="previewNote" class="mono muted"></div></div>
        </div>

        <div class="barcodeBox">
          <div class="subtle">Barcode encodes the order summary. If it doesn’t scan, cashier can read the receipt.</div>
          <svg id="barcode"></svg>
        </div>

        <div class="actions" style="justify-content:space-between;margin-top:10px">
          <button id="copyBtn" type="button">Copy order text</button>
          <button id="printBtn" type="button">Print</button>
        </div>
      </aside>
    </main>
  </div>

  <div class="modalBackdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="finalTitle">
      <header>
        <div class="brand">
          <h1 id="finalTitle">MyOrder — Show this to the cashier</h1>
          <p>Receipt-style order + barcode. Keep your screen brightness up for easier scanning.</p>
        </div>
        <div class="pill"><span>Order:</span> <b id="modalOrderId"></b></div>
      </header>
      <div class="content">
        <div class="receipt" id="modalReceipt"></div>
        <div class="barcodeBox">
          <svg id="modalBarcode"></svg>
          <div class="printNote">You can also <b>print</b> or <b>copy</b> the order text.</div>
        </div>
        <div class="actions" style="justify-content:space-between">
          <button id="closeModalBtn" type="button">Back</button>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button id="copyModalBtn" type="button">Copy</button>
            <button class="primary" id="printModalBtn" type="button">Print</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const VEGGIES = [
      "Lettuce","Spinach","Tomatoes","Cucumbers","Green peppers","Onions",
      "Pickles","Jalapeños","Banana peppers","Black olives"
    ];
    const SAUCES = [
      "Mayo","Light mayo","Chipotle Southwest","Honey mustard","Ranch",
      "Sweet onion","BBQ","Mustard","Oil","Vinegar"
    ];

    const $ = (id) => document.getElementById(id);
    const nowLocal = () => new Date().toLocaleString([], {year:"numeric", month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit"});
    const clean = (s) => (s || "").toString().trim();
    const uniqOrderId = () => {
      const d = new Date();
      const y = d.getFullYear().toString().slice(2);
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      const rnd = Math.random().toString(36).slice(2,7).toUpperCase();
      return `MO-${y}${m}${day}-${rnd}`;
    };
    const getChecked = (containerId) =>
      [...document.querySelectorAll(`#${containerId} .chip[data-on="1"]`)].map(el => el.dataset.value);

    function renderChips(containerId, values){
      const root = $(containerId);
      root.innerHTML = "";
      values.forEach(v => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "chip";
        btn.dataset.on = "0";
        btn.dataset.value = v;
        btn.innerHTML = `<span>${v}</span>`;
        btn.addEventListener("click", () => {
          btn.dataset.on = btn.dataset.on === "1" ? "0" : "1";
          updatePreview();
        });
        root.appendChild(btn);
      });
    }

    function gatherOrder(){
      const name = clean($("customerName").value);
      const storeNote = clean($("storeNote").value);
      const special = clean($("specialInstructions").value);

      const sandwich = $("sandwich").value;
      const size = $("size").value;
      const bread = $("bread").value;
      const toast = $("toast").value;
      const cheese = $("cheese").value;
      const extraCheese = $("extraCheese").value;
      const seasoning = $("seasoning").value;
      const extras = $("extras").value;
      const side = $("side").value;
      const drink = $("drink").value;
      const veggies = getChecked("vegChoices");
      const sauces = getChecked("sauceChoices");

      const orderId = window.__orderId || (window.__orderId = uniqOrderId());
      const createdAt = window.__createdAt || (window.__createdAt = nowLocal());

      return {
        orderId, createdAt, name, storeNote, special,
        sandwich, size, bread, toast, cheese, extraCheese,
        veggies, sauces, seasoning, extras, side, drink
      };
    }

    function formatOrderText(o){
      const lines = [];
      lines.push(`MyOrder ${o.orderId}`);
      if (o.name) lines.push(`Name: ${o.name}`);
      lines.push(`Item: ${o.size} ${o.sandwich}`);
      lines.push(`Bread: ${o.bread}`);
      lines.push(`Toasted: ${o.toast}`);
      lines.push(`Cheese: ${o.cheese}${o.extraCheese === "Yes" ? " (extra)" : ""}`);
      if (o.extras && o.extras !== "None") lines.push(`Extras: ${o.extras}`);
      if (o.seasoning && o.seasoning !== "None") lines.push(`Seasoning: ${o.seasoning}`);
      lines.push(`Veggies: ${o.veggies.length ? o.veggies.join(", ") : "None"}`);
      lines.push(`Sauces: ${o.sauces.length ? o.sauces.join(", ") : "None"}`);
      if (o.side && o.side !== "None") lines.push(`Side: ${o.side}`);
      if (o.drink && o.drink !== "None") lines.push(`Drink: ${o.drink}`);
      if (o.storeNote) lines.push(`Note: ${o.storeNote}`);
      if (o.special) lines.push(`Special: ${o.special}`);
      lines.push(`Created: ${o.createdAt}`);
      return lines.join("\n");
    }

    function escapeHtml(str){
      return (str ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function formatReceiptHTML(o){
      const note = (o.storeNote || o.special) ? [o.storeNote, o.special].filter(Boolean).join(" • ") : "—";
      const veg = o.veggies.length ? o.veggies.join(", ") : "None";
      const sau = o.sauces.length ? o.sauces.join(", ") : "None";

      return `
        <div class="title">
          <div>
            <h3>MyOrder — Final Order</h3>
            <div class="meta">Created ${escapeHtml(o.createdAt)}</div>
          </div>
          <div class="mono muted">${escapeHtml(o.orderId)}</div>
        </div>
        <div class="line"></div>
        <div class="kv"><span>Name</span><div class="mono">${o.name ? escapeHtml(o.name) : "<span class='muted'>—</span>"}</div></div>
        <div class="kv"><span>Item</span><div><b>${escapeHtml(o.size)} ${escapeHtml(o.sandwich)}</b></div></div>
        <div class="kv"><span>Bread</span><div>${escapeHtml(o.bread)}</div></div>
        <div class="kv"><span>Toasted</span><div>${escapeHtml(o.toast)}</div></div>
        <div class="kv"><span>Cheese</span><div>${escapeHtml(o.cheese)}${o.extraCheese === "Yes" ? " <span class='muted'>(extra)</span>" : ""}</div></div>
        <div class="kv"><span>Extras</span><div class="mono muted">${escapeHtml(o.extras)}</div></div>
        <div class="kv"><span>Seasoning</span><div class="mono muted">${escapeHtml(o.seasoning)}</div></div>
        <div class="line"></div>
        <div class="kv"><span>Veggies</span><div class="mono muted">${escapeHtml(veg)}</div></div>
        <div class="kv"><span>Sauces</span><div class="mono muted">${escapeHtml(sau)}</div></div>
        <div class="kv"><span>Side</span><div class="mono muted">${escapeHtml(o.side)}</div></div>
        <div class="kv"><span>Drink</span><div class="mono muted">${escapeHtml(o.drink)}</div></div>
        <div class="line"></div>
        <div class="kv"><span>Note</span><div class="mono muted">${escapeHtml(note)}</div></div>
      `;
    }

    function updateBarcode(svgEl, text){
      try{
        JsBarcode(svgEl, text, {
          format: "CODE128",
          lineColor: "#0f172a",
          background: "transparent",
          width: 2,
          height: 64,
          displayValue: true,
          fontSize: 12,
          margin: 0
        });
      }catch(e){
        svgEl.innerHTML = "";
      }
    }

    function updatePreview(){
      const o = gatherOrder();
      $("previewMeta").textContent = `Created ${o.createdAt}`;
      $("previewOrderId").textContent = o.orderId;

      const veg = o.veggies.length ? o.veggies.join(", ") : "None";
      const sau = o.sauces.length ? o.sauces.join(", ") : "None";
      const note = (o.storeNote || o.special) ? [o.storeNote, o.special].filter(Boolean).join(" • ") : "—";
      $("previewNote").textContent = note;

      $("previewItems").innerHTML = `
        <div class="kv"><span>Name</span><div class="mono muted">${escapeHtml(o.name || "—")}</div></div>
        <div class="kv"><span>Item</span><div><b>${escapeHtml(o.size)} ${escapeHtml(o.sandwich)}</b></div></div>
        <div class="kv"><span>Bread</span><div class="mono muted">${escapeHtml(o.bread)}</div></div>
        <div class="kv"><span>Toasted</span><div class="mono muted">${escapeHtml(o.toast)}</div></div>
        <div class="kv"><span>Cheese</span><div class="mono muted">${escapeHtml(o.cheese)}${o.extraCheese === "Yes" ? " (extra)" : ""}</div></div>
        <div class="kv"><span>Extras</span><div class="mono muted">${escapeHtml(o.extras)}</div></div>
        <div class="kv"><span>Seasoning</span><div class="mono muted">${escapeHtml(o.seasoning)}</div></div>
        <div class="kv"><span>Veggies</span><div class="mono muted">${escapeHtml(veg)}</div></div>
        <div class="kv"><span>Sauces</span><div class="mono muted">${escapeHtml(sau)}</div></div>
        <div class="kv"><span>Side</span><div class="mono muted">${escapeHtml(o.side)}</div></div>
        <div class="kv"><span>Drink</span><div class="mono muted">${escapeHtml(o.drink)}</div></div>
      `;

      const compact = `${o.orderId}|${o.size}|${o.sandwich}|${o.bread}|${o.toast}`;
      updateBarcode($("barcode"), compact);
    }

    function openModal(){
      const o = gatherOrder();
      $("statusText").textContent = "Ready";
      $("modalOrderId").textContent = o.orderId;
      $("modalReceipt").innerHTML = formatReceiptHTML(o);

      const compact = `${o.orderId}|${o.size}|${o.sandwich}|${o.bread}|${o.toast}`;
      updateBarcode($("modalBarcode"), compact);

      $("modal").dataset.open = "1";
    }
    function closeModal(){ $("modal").dataset.open = "0"; }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch{
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        return true;
      }
    }

    function resetAll(){
      $("customerName").value = "";
      $("storeNote").value = "";
      $("specialInstructions").value = "";
      $("sandwich").selectedIndex = 0;
      $("size").selectedIndex = 0;
      $("bread").selectedIndex = 0;
      $("toast").selectedIndex = 0;
      $("cheese").selectedIndex = 0;
      $("extraCheese").selectedIndex = 0;
      $("seasoning").selectedIndex = 0;
      $("extras").selectedIndex = 0;
      $("side").selectedIndex = 0;
      $("drink").selectedIndex = 0;
      [...document.querySelectorAll(".chip")].forEach(c => c.dataset.on = "0");
      window.__orderId = uniqOrderId();
      window.__createdAt = nowLocal();
      $("statusText").textContent = "Building";
      updatePreview();
    }

    function saveToLocal(){
      const o = gatherOrder();
      const payload = { savedAt: new Date().toISOString(), order: o, text: formatOrderText(o) };
      localStorage.setItem("myorder:last", JSON.stringify(payload));
    }

    function loadFromLocal(){
      try{
        const raw = localStorage.getItem("myorder:last");
        if(!raw) return false;
        const parsed = JSON.parse(raw);
        const o = parsed.order;

        $("customerName").value = o.name || "";
        $("storeNote").value = o.storeNote || "";
        $("specialInstructions").value = o.special || "";
        $("sandwich").value = o.sandwich || $("sandwich").value;
        $("size").value = o.size || $("size").value;
        $("bread").value = o.bread || $("bread").value;
        $("toast").value = o.toast || $("toast").value;
        $("cheese").value = o.cheese || $("cheese").value;
        $("extraCheese").value = o.extraCheese || $("extraCheese").value;
        $("seasoning").value = o.seasoning || $("seasoning").value;
        $("extras").value = o.extras || $("extras").value;
        $("side").value = o.side || $("side").value;
        $("drink").value = o.drink || $("drink").value;

        const vegSet = new Set(o.veggies || []);
        const sauceSet = new Set(o.sauces || []);
        [...document.querySelectorAll("#vegChoices .chip")].forEach(c => c.dataset.on = vegSet.has(c.dataset.value) ? "1" : "0");
        [...document.querySelectorAll("#sauceChoices .chip")].forEach(c => c.dataset.on = sauceSet.has(c.dataset.value) ? "1" : "0");

        window.__orderId = o.orderId || uniqOrderId();
        window.__createdAt = o.createdAt || nowLocal();
        updatePreview();
        return true;
      }catch{
        return false;
      }
    }

    // Init
    renderChips("vegChoices", VEGGIES);
    renderChips("sauceChoices", SAUCES);
    window.__orderId = uniqOrderId();
    window.__createdAt = nowLocal();

    ["customerName","storeNote","specialInstructions","sandwich","size","bread","toast","cheese","extraCheese","seasoning","extras","side","drink"]
      .forEach(id => $(id).addEventListener("input", updatePreview));
    ["sandwich","size","bread","toast","cheese","extraCheese","seasoning","extras","side","drink"]
      .forEach(id => $(id).addEventListener("change", updatePreview));

    $("orderBtn").addEventListener("click", openModal);
    $("closeModalBtn").addEventListener("click", closeModal);
    $("modal").addEventListener("click", (e) => { if(e.target === $("modal")) closeModal(); });
    window.addEventListener("keydown", (e) => { if(e.key === "Escape") closeModal(); });

    $("copyBtn").addEventListener("click", async () => { await copyText(formatOrderText(gatherOrder())); });
    $("copyModalBtn").addEventListener("click", async () => { await copyText(formatOrderText(gatherOrder())); });
    $("printBtn").addEventListener("click", () => window.print());
    $("printModalBtn").addEventListener("click", () => window.print());

    $("resetBtn").addEventListener("click", resetAll);
    $("saveBtn").addEventListener("click", () => {
      saveToLocal();
      $("statusText").textContent = "Saved";
      setTimeout(() => $("statusText").textContent = "Building", 1200);
    });

    loadFromLocal();
    updatePreview();
  </script>
</body>
</html>